"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[91],{3091:function(e,n,t){t.r(n),t.d(n,{default:function(){return j}});var r=t(5861),s=t(2982),a=t(885),c=t(7757),i=t.n(c),o=t(2791),l=t(4569),u=t.n(l),d=t(9434),v=t(6256),m=t(184);var h=function(e){var n=e.onlineUsers,t=e.currentId,s=e.setCurrentChat,a=(0,d.v9)((function(e){return e.user})).user,c=function(){var e=(0,r.Z)(i().mark((function e(n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u().get("/api/v1/conversation/find/".concat(t,"/").concat(n._id));case 3:r=e.sent,a=r.data,s(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(n){return e.apply(this,arguments)}}();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"chatOnline",children:[(0,m.jsx)("p",{className:"text-on-online",children:"Online Users"}),n&&n.length>0?null===n||void 0===n?void 0:n.map((function(e){return(0,m.jsxs)("div",{className:"chatOnlineFriend",onClick:function(){return c(e)},children:[(0,m.jsxs)("div",{className:"chatOnlineImgContainer",children:[(0,m.jsx)("img",{className:"chatOnlineImg",src:null===e||void 0===e?void 0:e.avatar.url,alt:"online friend avatar"}),(0,m.jsx)("div",{className:"chatOnlineBadge"})]}),(0,m.jsx)("span",{className:"chatOnlineName",children:null===e||void 0===e?void 0:e.name})]},e._id)})):(0,m.jsxs)("p",{style:{color:"rgb(118, 118, 124)"},children:[(0,m.jsx)(v.Z,{})," ",(0,m.jsx)("span",{className:"no-one-online",children:"Oops.. everyone is having a break time!"})," "]})]}),(0,m.jsx)("div",{children:(0,m.jsxs)("div",{className:"chatOnline",children:[(0,m.jsx)("p",{className:"text-on-online mt-2",children:"Friends list"}),a&&a.following.length>0?a.following.map((function(e){return(0,m.jsxs)("div",{className:"chatOnlineFriend",onClick:function(){return c(e)},children:[(0,m.jsx)("div",{className:"chatOnlineImgContainer",children:(0,m.jsx)("img",{className:"chatOnlineImg",src:e.avatar.url,alt:""})}),(0,m.jsx)("span",{className:"chatOnlineName",children:e.name})]})})):(0,m.jsx)("p",{style:{margin:"2vmax"},children:" You're not following anyone"})]})})]})};var f=function(e){var n=e.conversation,t=e.currentUser,s=(0,o.useState)(null),c=(0,a.Z)(s,2),l=c[0],d=c[1];return(0,o.useEffect)((function(){var e=n.members.find((function(e){return e!==t._id})),s=function(){var n=(0,r.Z)(i().mark((function n(){var t,r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,u()("/api/v1/user/".concat(e));case 3:t=n.sent,r=t.data,d(r.user),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(){return n.apply(this,arguments)}}();s()}),[t,n]),(0,m.jsxs)("div",{className:"conversation",children:[(0,m.jsx)("img",{className:"conversationImg",src:l&&l.avatar.url,alt:""}),(0,m.jsx)("span",{className:"conversationName",children:l&&l.name})]})},x=t(6314);var p=function(e){var n=e.message,t=e.own;return(0,m.jsxs)("div",{className:t?"message own":"message",children:[(0,m.jsxs)("div",{className:"messageTop",children:[(0,m.jsx)("img",{className:"messageImg",src:null===n||void 0===n?void 0:n.sender.avatar.url,alt:""}),(0,m.jsx)("p",{className:"messageText",children:n.text})]}),(0,m.jsx)("div",{className:"messageBottom",children:(0,x.WU)(n.createdAt)})]})},g=t(9609);var j=function(){var e=(0,o.useState)([]),n=(0,a.Z)(e,2),t=n[0],c=n[1],l=(0,o.useState)(null),v=(0,a.Z)(l,2),x=v[0],j=v[1],N=(0,o.useState)([]),w=(0,a.Z)(N,2),k=w[0],b=w[1],_=(0,o.useState)(""),O=(0,a.Z)(_,2),C=O[0],Z=O[1],I=(0,o.useState)(null),y=(0,a.Z)(I,2),S=y[0],B=y[1],E=(0,o.useState)(null),U=(0,a.Z)(E,2),F=U[0],M=U[1],T=(0,o.useRef)((0,g.io)("https://trvalista.online")),W=(0,o.useRef)(),R=(0,d.v9)((function(e){return e.user})).user;(0,o.useEffect)((function(){return T.current=(0,g.io)("https://travalista.online"),T.current.on("getMessage",(function(e){B({sender:e.sender,text:e.text,createdAt:Date.now()})})),function(){T.current.close()}}),[T]),(0,o.useEffect)((function(){S&&(null===x||void 0===x?void 0:x.members.includes(S.sender._id))&&b((function(e){return[].concat((0,s.Z)(e),[S])}))}),[S,x]),(0,o.useEffect)((function(){T.current.emit("addUser",R._id),T.current.on("getUsers",(function(e){e=JSON.parse(e),M(R.following.filter((function(n){return e.some((function(e){return e.userId===n._id}))})))}))}),[R.following,R._id]),(0,o.useEffect)((function(){var e=function(){var e=(0,r.Z)(i().mark((function e(){var n,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u().get("/api/v1/conversation/".concat(R._id));case 3:n=e.sent,t=n.data,c(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[R._id]),(0,o.useEffect)((function(){var e=function(){var e=(0,r.Z)(i().mark((function e(){var n,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u().get("/api/v1/message/".concat(null===x||void 0===x?void 0:x._id));case 3:n=e.sent,t=n.data,b(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[x]);var A=function(){var e=(0,r.Z)(i().mark((function e(n){var t,r,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),t={sender:R,text:C,conversationId:x._id},r=x.members.find((function(e){return e!==R._id})),T.current.emit("sendMessage",{senderId:{avatar:R.avatar,_id:R._id},receiverId:r,text:C}),e.prev=4,e.next=7,u().post("/api/v1/message",t);case 7:a=e.sent,c=a.data,b([].concat((0,s.Z)(k),[c])),Z(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(n){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){var e;null===(e=W.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[k]),(0,m.jsx)("div",{className:"body-messager pt-2 ",children:(0,m.jsxs)("div",{className:"messenger  container",children:[(0,m.jsx)("div",{className:"chatMenu d-none d-sm-block col-2",children:(0,m.jsxs)("div",{className:"chatMenuWrapper",children:[(0,m.jsx)("h5",{children:"Recent Chats"}),t.map((function(e){return(0,m.jsx)("div",{onClick:function(){return j(e)},children:(0,m.jsx)(f,{conversation:e,currentUser:R})},e._id)}))]})}),(0,m.jsx)("div",{className:"chatBox col-sm-8",children:(0,m.jsx)("div",{className:"chatBoxWrapper",children:x?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"chatBoxTop",children:k.map((function(e){return(0,m.jsx)("div",{ref:W,children:(0,m.jsx)(p,{message:e,own:e.sender._id===R._id})},e._id)}))}),(0,m.jsxs)("div",{className:"chatBoxBottom",children:[(0,m.jsx)("input",{type:"text",className:"chatMessageInput",placeholder:"write something...",onChange:function(e){return Z(e.target.value)},value:C,onKeyPress:function(e){"Enter"===e.key&&A(e)}}),C.length<1?(0,m.jsx)("button",{className:"chatSubmitButton",children:"Send"}):(0,m.jsx)("button",{className:"chatSubmitButton",onClick:A,children:"Send"})]})]}):(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("p",{className:"noConversationText",children:"Open a conversation to start a chat."})})})}),(0,m.jsx)("div",{className:"chatOnline col-4 col-sm-2",children:(0,m.jsx)("div",{className:"chatOnlineWrapper",children:(0,m.jsx)(h,{onlineUsers:F&&F,currentId:R._id,setCurrentChat:j})})})]})})}}}]);
//# sourceMappingURL=91.a1117956.chunk.js.map